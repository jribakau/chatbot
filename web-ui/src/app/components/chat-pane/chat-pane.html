<main class="chat-pane">
    <!-- <header class="chat-header">
        <div class="participant">
            <div class="avatar large">
                @if (activeCharacter && getProfileImageUrl(activeCharacter)) {
                <img [src]="getProfileImageUrl(activeCharacter)" [alt]="activeCharacter.name" />
                } @else {
                {{ activeCharacter ? getInitials(activeCharacter.name) : 'ü§ñ' }}
                }
            </div>
            <div>
                <div class="name">{{ activeCharacter?.name || 'Select a character' }}</div>
                <div class="status">Online</div>
            </div>
        </div>
    </header> -->

    <section class="messages" #messagesScroll>
        @for (m of messages; track m.id || $index) {
        <div class="message" [ngClass]="m.role">
            <div class="bubble">
                @if (!isEditing(m)) {
                <div class="content">{{ m.content }}</div>
                <div class="timestamp">{{ m.timestamp | date: 'shortTime' }}</div>
                <div class="message-actions">
                    <button class="edit-btn" title="Edit message" (click)="startEdit(m)">‚úèÔ∏è</button>
                </div>
                }
                @if (isEditing(m)) {
                <div class="edit-mode">
                    <textarea [(ngModel)]="editContent" class="edit-textarea" rows="3"></textarea>
                    <div class="edit-actions">
                        <button class="save-btn" (click)="saveEdit(m)" [disabled]="!editContent.trim()">Save</button>
                        <button class="cancel-btn" (click)="cancelEdit()">Cancel</button>
                    </div>
                </div>
                }
            </div>
        </div>
        }

        @if (isTyping) {
        <div class="typing">
            <span></span><span></span><span></span>
        </div>
        }

    </section>

    <footer class="composer">
        <textarea [(ngModel)]="draft" (ngModelChange)="onDraftChange($event)" (keydown)="onKeyDown($event)"
            placeholder="Write a message..." rows="1"></textarea>
        <button class="send-btn" [disabled]="!draft.trim()" (click)="send()">Send</button>
    </footer>
</main>