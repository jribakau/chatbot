<main class="chat-pane">
    <header class="chat-header">
        <div class="participant">
            <div class="avatar large">{{ activeCharacter?.name ? (activeCharacter?.name?.slice(0,1) | uppercase) : 'ðŸ¤–'
                }}
            </div>
            <div>
                <div class="name">{{ activeCharacter?.name || 'Select a character' }}</div>
                <div class="status">Online</div>
            </div>
        </div>
        <div class="actions">
            <button class="icon-btn" title="Logout" (click)="onLogout()">âŽ‹</button>
            <button class="icon-btn" title="Clear chat" (click)="onClearChat()">ðŸ—‘</button>
            <button class="icon-btn" title="Settings" (click)="onSettingsClicked()">âš™</button>
        </div>
    </header>

    <section class="messages" #messagesScroll>
        <div class="message" *ngFor="let m of messages" [ngClass]="m.role">
            <div class="bubble">
                <div class="content">{{ m.content }}</div>
                <div class="timestamp">{{ m.timestamp | date: 'shortTime' }}</div>
            </div>
        </div>

        <div class="typing" *ngIf="isTyping">
            <span></span><span></span><span></span>
        </div>
    </section>

    <footer class="composer">
        <textarea [(ngModel)]="draft" (ngModelChange)="onDraftChange($event)" (keydown)="onKeyDown($event)"
            placeholder="Write a message..." rows="1"></textarea>
        <button class="send-btn" [disabled]="!draft.trim()" (click)="send()">Send</button>
    </footer>
</main>