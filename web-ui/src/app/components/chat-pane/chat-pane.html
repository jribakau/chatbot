<main class="chat-pane">
    <header class="chat-header">
        <div class="participant">
            <div class="avatar large">{{ activeCharacter?.name ? (activeCharacter?.name?.slice(0,1) | uppercase) : 'ü§ñ'
                }}
            </div>
            <div>
                <div class="name">{{ activeCharacter?.name || 'Select a character' }}</div>
                <div class="status">Online</div>
            </div>
        </div>
    </header>

    <section class="messages" #messagesScroll>
        <div class="message" *ngFor="let m of messages" [ngClass]="m.role">
            <div class="bubble">
                <div *ngIf="!isEditing(m)">
                    <div class="content">{{ m.content }}</div>
                    <div class="timestamp">{{ m.timestamp | date: 'shortTime' }}</div>
                    <div class="message-actions">
                        <button class="edit-btn" title="Edit message" (click)="startEdit(m)">‚úèÔ∏è</button>
                    </div>
                </div>
                <div *ngIf="isEditing(m)" class="edit-mode">
                    <textarea [(ngModel)]="editContent" class="edit-textarea" rows="3"></textarea>
                    <div class="edit-actions">
                        <button class="save-btn" (click)="saveEdit(m)" [disabled]="!editContent.trim()">Save</button>
                        <button class="cancel-btn" (click)="cancelEdit()">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="typing" *ngIf="isTyping">
            <span></span><span></span><span></span>
        </div>
    </section>

    <footer class="composer">
        <textarea [(ngModel)]="draft" (ngModelChange)="onDraftChange($event)" (keydown)="onKeyDown($event)"
            placeholder="Write a message..." rows="1"></textarea>
        <button class="send-btn" [disabled]="!draft.trim()" (click)="send()">Send</button>
    </footer>
</main>