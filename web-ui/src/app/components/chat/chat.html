<div class="chat-container">
  <aside class="sidebar">
    <div class="brand">Chatbot</div>
    <div class="conversations-header">
      <button class="new-chat-btn" (click)="startNewChat()" [disabled]="!selectedCharacterId">+ New Chat</button>
    </div>
    <ul class="conversation-list">
      <li
        class="conversation-item"
        *ngFor="let ch of characters"
        [class.active]="ch.id === selectedCharacterId"
        (click)="selectCharacter(ch.id)"
      >
        <div class="avatar">{{ (ch.name?.slice(0,1) | uppercase) || 'ðŸ¤–' }}</div>
        <div class="meta">
          <div class="name">{{ ch.name }}</div>
          <div class="last-message" title="{{ ch.shortGreeting || ch.description }}">{{ ch.shortGreeting || ch.description }}</div>
        </div>
      </li>
    </ul>
  </aside>

  <main class="chat-pane">
    <header class="chat-header">
      <div class="participant">
        <div class="avatar large">{{ activeCharacter?.name ? (activeCharacter.name.slice(0,1) | uppercase) : 'ðŸ¤–' }}</div>
        <div>
          <div class="name">{{ activeCharacter?.name || 'Select a character' }}</div>
          <div class="status">Online</div>
        </div>
      </div>
      <div class="actions">
        <button class="icon-btn" title="Logout" (click)="onLogout()">âŽ‹</button>
        <button class="icon-btn" title="Clear chat" (click)="clearChat()">ðŸ—‘</button>
        <button class="icon-btn" title="Settings" (click)="toggleSettings()">âš™</button>
      </div>
    </header>

    <section class="messages" #messagesScroll>
      <div
        class="message"
        *ngFor="let m of messages"
        [ngClass]="m.role"
      >
        <div class="bubble">
          <div class="content">{{ m.content }}</div>
          <div class="timestamp">{{ m.timestamp | date: 'shortTime' }}</div>
        </div>
      </div>

      <div class="typing" *ngIf="isTyping">
        <span></span><span></span><span></span>
      </div>
    </section>

    <footer class="composer">
      <textarea
        [(ngModel)]="draft"
        (keydown)="onKeyDown($event)"
        placeholder="Write a message..."
        rows="1"
      ></textarea>
      <button class="send-btn" [disabled]="!draft.trim() || !selectedCharacterId" (click)="send()">Send</button>
    </footer>
  </main>
</div>
